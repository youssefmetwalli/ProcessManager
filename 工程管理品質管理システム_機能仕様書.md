# 工程管理・品質管理チェックシステム 機能仕様書

**バージョン:** 1.0  
**作成日:** 2025年3月15日  
**対象:** 製造業・建設業における現場作業の工程管理・品質管理

---

## 目次

1. [システム概要](#1-システム概要)
2. [データモデル](#2-データモデル)
3. [機能仕様](#3-機能仕様)
4. [画面別機能詳細](#4-画面別機能詳細)
5. [実装優先度](#5-実装優先度)
6. [非機能要件](#6-非機能要件)

---

## 1. システム概要

### 1.1 目的

製造業や建設業などの現場作業における工程管理と品質管理をデジタル化し、作業の標準化、品質の向上、トレーサビリティの確保を実現する。

### 1.2 主要利用者

- **管理者**: チェック項目、作業チェックリスト、工程チェックシートの作成・管理、進捗監視、品質分析、帳票出力
- **作業者**: タブレット等で工程チェックシートを実行し、現場情報(OK/NG、数値、テキスト、写真、手書きコメント等)を入力

### 1.3 システム構成

- **フロントエンド**: レスポンシブWebアプリケーション(PC/タブレット対応)
- **バックエンド**: RESTful API
- **データベース**: リレーショナルデータベース
- **外部連携**: 外部システムとのAPI連携(Phase 3)

---

## 2. データモデル

### 2.1 エンティティ関係図

```
ユーザー (User)
  ├─ 1:N → 実行履歴 (ExecutionHistory)
  └─ N:M → チーム (Team)

チェック項目マスタ (CheckItemMaster)
  ├─ 1:N → 作業チェックリスト項目 (ChecklistItem)
  └─ 1:N → 選択肢 (Option)

作業チェックリスト (Checklist)
  ├─ 1:N → 作業チェックリスト項目 (ChecklistItem)
  └─ N:M → 工程チェックシート (ProcessSheet)

工程チェックシート (ProcessSheet)
  ├─ N:M → 作業チェックリスト (Checklist)
  ├─ 1:N → 実行履歴 (ExecutionHistory)
  └─ N:1 → 製品/ロット (Product/Lot)

実行履歴 (ExecutionHistory)
  ├─ N:1 → 工程チェックシート (ProcessSheet)
  ├─ N:1 → ユーザー (実行者)
  ├─ N:1 → ユーザー (承認者)
  └─ 1:N → 実行結果 (ExecutionResult)

実行結果 (ExecutionResult)
  ├─ N:1 → 実行履歴 (ExecutionHistory)
  ├─ N:1 → チェック項目マスタ (CheckItemMaster)
  └─ 1:N → 添付ファイル (Attachment)
```

### 2.2 主要エンティティ定義

#### 2.2.1 ユーザー (User)

| フィールド名 | 型 | 必須 | 説明 |
|------------|---|------|------|
| id | UUID | ○ | ユーザーID |
| username | String | ○ | ユーザー名(ログイン用) |
| email | String | ○ | メールアドレス |
| full_name | String | ○ | 氏名 |
| password_hash | String | ○ | パスワードハッシュ |
| role | Enum | ○ | 役割(管理者/作業者/閲覧者) |
| team_ids | Array[UUID] |  | 所属チームIDリスト |
| is_active | Boolean | ○ | アクティブフラグ |
| created_at | DateTime | ○ | 作成日時 |
| updated_at | DateTime | ○ | 更新日時 |

#### 2.2.2 チェック項目マスタ (CheckItemMaster)

| フィールド名 | 型 | 必須 | 説明 |
|------------|---|------|------|
| id | UUID | ○ | チェック項目ID |
| name | String | ○ | 項目名 |
| description | Text |  | 説明 |
| item_type | Enum | ○ | 項目タイプ(テキスト/数値/日付/選択肢/複数選択/画像/署名/GPS/ファイル) |
| reference_image_url | String |  | 参考画像URL |
| allow_drawing | Boolean | ○ | 手書きコメント許可フラグ |
| validation_rules | JSON |  | バリデーションルール |
| default_value | String |  | デフォルト値 |
| unit | String |  | 単位(数値項目の場合) |
| category | String |  | カテゴリ |
| tags | Array[String] |  | タグ |
| usage_count | Integer | ○ | 使用回数 |
| is_active | Boolean | ○ | アクティブフラグ |
| created_by | UUID | ○ | 作成者ID |
| created_at | DateTime | ○ | 作成日時 |
| updated_at | DateTime | ○ | 更新日時 |

**item_type の値:**
- `TEXT`: テキスト入力
- `NUMBER`: 数値入力
- `DATE`: 日付入力
- `SINGLE_SELECT`: 単一選択(ラジオボタン/ドロップダウン)
- `MULTI_SELECT`: 複数選択(チェックボックス)
- `IMAGE`: 画像撮影/アップロード
- `SIGNATURE`: 署名入力
- `GPS`: GPS位置情報
- `FILE`: ファイルアップロード

**validation_rules の構造例:**
```json
{
  "required": true,
  "min": 0,
  "max": 100,
  "pattern": "^[0-9]+$",
  "custom_message": "0〜100の整数を入力してください"
}
```

#### 2.2.3 選択肢 (Option)

| フィールド名 | 型 | 必須 | 説明 |
|------------|---|------|------|
| id | UUID | ○ | 選択肢ID |
| check_item_id | UUID | ○ | チェック項目ID |
| parent_option_id | UUID |  | 親選択肢ID(階層構造用) |
| label | String | ○ | 選択肢ラベル |
| value | String | ○ | 選択肢値 |
| display_order | Integer | ○ | 表示順序 |
| is_ng | Boolean | ○ | NG判定フラグ |
| is_active | Boolean | ○ | アクティブフラグ |

#### 2.2.4 作業チェックリスト (Checklist)

| フィールド名 | 型 | 必須 | 説明 |
|------------|---|------|------|
| id | UUID | ○ | チェックリストID |
| name | String | ○ | チェックリスト名 |
| description | Text |  | 説明 |
| category | String |  | カテゴリ |
| estimated_duration | Integer |  | 推定作業時間(分) |
| is_template | Boolean | ○ | テンプレートフラグ |
| qr_code_url | String |  | QRコードURL |
| version | Integer | ○ | バージョン番号 |
| is_active | Boolean | ○ | アクティブフラグ |
| created_by | UUID | ○ | 作成者ID |
| created_at | DateTime | ○ | 作成日時 |
| updated_at | DateTime | ○ | 更新日時 |

#### 2.2.5 作業チェックリスト項目 (ChecklistItem)

| フィールド名 | 型 | 必須 | 説明 |
|------------|---|------|------|
| id | UUID | ○ | チェックリスト項目ID |
| checklist_id | UUID | ○ | チェックリストID |
| check_item_id | UUID | ○ | チェック項目マスタID |
| display_order | Integer | ○ | 表示順序 |
| is_required | Boolean | ○ | 必須フラグ |
| condition_rule | JSON |  | 条件分岐ルール |

**condition_rule の構造例:**
```json
{
  "show_if": {
    "item_id": "uuid-123",
    "operator": "equals",
    "value": "NG"
  }
}
```

#### 2.2.6 工程チェックシート (ProcessSheet)

| フィールド名 | 型 | 必須 | 説明 |
|------------|---|------|------|
| id | UUID | ○ | 工程チェックシートID |
| name | String | ○ | シート名 |
| description | Text |  | 説明 |
| product_id | UUID |  | 製品ID |
| lot_number | String |  | ロット番号 |
| process_flow | JSON | ○ | 工程フロー定義 |
| estimated_duration | Integer |  | 推定作業時間(分) |
| status | Enum | ○ | ステータス(計画中/実行準備/実行中/完了/保留) |
| is_active | Boolean | ○ | アクティブフラグ |
| created_by | UUID | ○ | 作成者ID |
| created_at | DateTime | ○ | 作成日時 |
| updated_at | DateTime | ○ | 更新日時 |

**process_flow の構造例:**
```json
{
  "nodes": [
    {
      "id": "node-1",
      "checklist_id": "uuid-123",
      "type": "checklist",
      "position": {"x": 100, "y": 100}
    }
  ],
  "edges": [
    {
      "id": "edge-1",
      "source": "node-1",
      "target": "node-2",
      "type": "sequential"
    }
  ]
}
```

#### 2.2.7 工程チェックシート-チェックリスト関連 (ProcessSheetChecklist)

| フィールド名 | 型 | 必須 | 説明 |
|------------|---|------|------|
| id | UUID | ○ | 関連ID |
| process_sheet_id | UUID | ○ | 工程チェックシートID |
| checklist_id | UUID | ○ | チェックリストID |
| display_order | Integer | ○ | 表示順序 |
| execution_type | Enum | ○ | 実行タイプ(直列/並列) |
| is_optional | Boolean | ○ | オプションフラグ |

#### 2.2.8 実行履歴 (ExecutionHistory)

| フィールド名 | 型 | 必須 | 説明 |
|------------|---|------|------|
| id | UUID | ○ | 実行履歴ID |
| process_sheet_id | UUID | ○ | 工程チェックシートID |
| executor_id | UUID | ○ | 実行者ID |
| start_time | DateTime | ○ | 開始日時 |
| end_time | DateTime |  | 終了日時 |
| status | Enum | ○ | ステータス(準備中/実行中/完了/中断/承認待ち/承認済み/差し戻し) |
| overall_result | Enum |  | 総合判定(合格/不合格/保留) |
| ng_count | Integer | ○ | NG項目数 |
| ok_count | Integer | ○ | OK項目数 |
| skip_count | Integer | ○ | スキップ項目数 |
| draft_data | JSON |  | ドラフトデータ |
| location_start | JSON |  | 開始位置(GPS) |
| location_end | JSON |  | 終了位置(GPS) |
| approver_id | UUID |  | 承認者ID |
| approved_at | DateTime |  | 承認日時 |
| approval_comment | Text |  | 承認コメント |
| created_at | DateTime | ○ | 作成日時 |
| updated_at | DateTime | ○ | 更新日時 |

#### 2.2.9 実行結果 (ExecutionResult)

| フィールド名 | 型 | 必須 | 説明 |
|------------|---|------|------|
| id | UUID | ○ | 実行結果ID |
| execution_history_id | UUID | ○ | 実行履歴ID |
| check_item_id | UUID | ○ | チェック項目ID |
| result_value | Text |  | 結果値 |
| result_type | Enum | ○ | 結果タイプ(OK/NG/NA/数値/テキスト) |
| numeric_value | Decimal |  | 数値結果 |
| text_value | Text |  | テキスト結果 |
| selected_options | Array[UUID] |  | 選択された選択肢IDリスト |
| comment | Text |  | コメント |
| drawing_data | JSON |  | 手書きデータ |
| location | JSON |  | GPS位置情報 |
| recorded_at | DateTime | ○ | 記録日時 |

#### 2.2.10 添付ファイル (Attachment)

| フィールド名 | 型 | 必須 | 説明 |
|------------|---|------|------|
| id | UUID | ○ | 添付ファイルID |
| execution_result_id | UUID | ○ | 実行結果ID |
| file_type | Enum | ○ | ファイルタイプ(画像/動画/PDF/その他) |
| file_url | String | ○ | ファイルURL |
| file_name | String | ○ | ファイル名 |
| file_size | Integer | ○ | ファイルサイズ(バイト) |
| thumbnail_url | String |  | サムネイルURL |
| metadata | JSON |  | メタデータ(EXIF等) |
| uploaded_at | DateTime | ○ | アップロード日時 |

#### 2.2.11 製品/ロット (Product/Lot)

| フィールド名 | 型 | 必須 | 説明 |
|------------|---|------|------|
| id | UUID | ○ | 製品/ロットID |
| product_code | String | ○ | 製品コード |
| product_name | String | ○ | 製品名 |
| lot_number | String |  | ロット番号 |
| specification | JSON |  | 仕様情報 |
| production_date | Date |  | 製造日 |
| expiry_date | Date |  | 有効期限 |
| metadata | JSON |  | メタデータ |
| created_at | DateTime | ○ | 作成日時 |
| updated_at | DateTime | ○ | 更新日時 |

#### 2.2.12 チーム (Team)

| フィールド名 | 型 | 必須 | 説明 |
|------------|---|------|------|
| id | UUID | ○ | チームID |
| name | String | ○ | チーム名 |
| description | Text |  | 説明 |
| parent_team_id | UUID |  | 親チームID |
| is_active | Boolean | ○ | アクティブフラグ |
| created_at | DateTime | ○ | 作成日時 |
| updated_at | DateTime | ○ | 更新日時 |

---

## 3. 機能仕様

### 3.1 認証・ユーザー管理

#### 3.1.1 ログイン機能

**機能概要:**  
ユーザー名とパスワードによる認証を行い、システムへのアクセスを制御する。

**詳細要件:**
- ユーザー名(またはメールアドレス)とパスワードによる認証
- パスワードはハッシュ化して保存(bcrypt等)
- ログイン失敗時のエラーメッセージ表示
- セッション管理(JWT等)
- ログイン履歴の記録
- 「ログイン状態を保持」オプション
- パスワードリセット機能(Phase 2)
- 二要素認証(Phase 3)

**入力:**
- ユーザー名/メールアドレス
- パスワード
- ログイン状態保持フラグ(オプション)

**出力:**
- 認証トークン
- ユーザー情報(ID、氏名、役割、権限)

**エラー処理:**
- 認証失敗時のエラーメッセージ
- アカウントロック(連続失敗時)

#### 3.1.2 ログアウト機能

**機能概要:**  
ユーザーをログアウトし、セッションを無効化する。

**詳細要件:**
- セッションの無効化
- ログアウト履歴の記録

#### 3.1.3 ユーザー管理機能

**機能概要:**  
ユーザーの作成、編集、削除、権限設定を行う。

**詳細要件:**
- ユーザーの新規作成
- ユーザー情報の編集(氏名、メールアドレス、役割)
- ユーザーの無効化/削除
- 役割の割り当て(管理者/作業者/閲覧者)
- チームへの割り当て
- パスワードの初期化

**権限:**
- 管理者のみ実行可能

#### 3.1.4 チーム管理機能 (Phase 2)

**機能概要:**  
チームの作成、編集、削除、メンバー管理を行う。

**詳細要件:**
- チームの新規作成
- チーム情報の編集
- チームの無効化/削除
- チーム階層の設定
- メンバーの追加/削除

---

### 3.2 チェック項目管理

#### 3.2.1 チェック項目マスタ一覧表示

**機能概要:**  
登録済みのチェック項目マスタを一覧表示し、検索・フィルタ・ソート機能を提供する。

**詳細要件:**
- チェック項目の一覧表示
  - 項目名
  - 項目タイプ
  - カテゴリ
  - 使用回数
  - 作成日
  - ステータス(アクティブ/非アクティブ)
- 検索機能(項目名、カテゴリ、タグ)
- フィルタ機能
  - 項目タイプ
  - カテゴリ
  - ステータス
- ソート機能(項目名、使用回数、作成日)
- ページネーション(20件/ページ)
- 新規作成ボタン
- 編集・削除ボタン(各行)

**表示項目:**
- 項目ID
- 項目名
- 項目タイプ(アイコン表示)
- カテゴリ
- 使用回数
- 作成日
- ステータス
- アクション(編集/削除/コピー)

#### 3.2.2 チェック項目マスタ作成・編集

**機能概要:**  
新しいチェック項目マスタを作成、または既存の項目を編集する。

**詳細要件:**
- 基本情報の入力
  - 項目名(必須)
  - 説明
  - 項目タイプ(必須)
  - カテゴリ
  - タグ(複数指定可能)
- 項目タイプ別の設定
  - **テキスト**: 最大文字数、正規表現パターン、デフォルト値
  - **数値**: 最小値、最大値、単位、小数点桁数、デフォルト値
  - **日付**: 日付形式、最小日付、最大日付、デフォルト値
  - **単一選択**: 選択肢の管理(後述)
  - **複数選択**: 選択肢の管理(後述)
  - **画像**: 最大ファイルサイズ、許可する形式
  - **署名**: -
  - **GPS**: 精度要件
  - **ファイル**: 最大ファイルサイズ、許可する形式
- バリデーションルールの設定
  - 必須フラグ
  - カスタムバリデーション
  - エラーメッセージ
- 参考画像のアップロード
- 手書きコメント許可フラグ
- プレビュー機能

**入力検証:**
- 項目名: 必須、1〜200文字
- 項目タイプ: 必須
- バリデーションルール: JSON形式

**エラー処理:**
- 必須項目未入力エラー
- バリデーションルールエラー
- 画像アップロードエラー

#### 3.2.3 選択肢管理

**機能概要:**  
単一選択・複数選択タイプのチェック項目に対する選択肢を管理する。

**詳細要件:**
- 選択肢の追加・編集・削除
- ドラッグ&ドロップによる並び替え
- 階層構造の設定(親子関係)
- NG判定フラグの設定
- 選択肢のインポート(CSV)
- 選択肢のエクスポート(CSV)

**表示項目:**
- 選択肢ラベル
- 選択肢値
- 階層レベル
- NG判定フラグ
- 表示順序
- アクション(編集/削除/移動)

#### 3.2.4 チェック項目マスタ削除

**機能概要:**  
チェック項目マスタを削除または無効化する。

**詳細要件:**
- 削除前の確認ダイアログ
- 使用中の項目は削除不可(警告表示)
- 無効化オプション(削除の代替)
- 削除履歴の記録

**削除条件:**
- 使用回数が0の場合のみ削除可能
- それ以外は無効化のみ

---

### 3.3 作業チェックリスト管理

#### 3.3.1 作業チェックリスト一覧表示

**機能概要:**  
登録済みの作業チェックリストを一覧表示し、検索・フィルタ・ソート機能を提供する。

**詳細要件:**
- チェックリストの一覧表示
  - リスト名
  - 説明
  - カテゴリ
  - 項目数
  - 推定作業時間
  - 使用回数
  - 作成日
  - テンプレートフラグ
  - ステータス
- 検索機能(リスト名、説明、カテゴリ)
- フィルタ機能
  - カテゴリ
  - テンプレートフラグ
  - ステータス
- ソート機能(リスト名、使用回数、作成日)
- カード表示/リスト表示の切り替え
- ページネーション
- 新規作成ボタン
- テンプレートからコピーボタン
- 編集・削除ボタン(各行)

#### 3.3.2 作業チェックリスト作成・編集

**機能概要:**  
新しい作業チェックリストを作成、または既存のリストを編集する。

**詳細要件:**
- 基本情報の入力
  - リスト名(必須)
  - 説明
  - カテゴリ
  - 推定作業時間
  - テンプレートフラグ
- チェック項目の追加
  - チェック項目マスタから選択
  - 検索機能(項目名、カテゴリ)
  - ドラッグ&ドロップで追加
- チェック項目の並び替え
  - ドラッグ&ドロップによる順序変更
- チェック項目の削除
- チェック項目の個別設定
  - 必須フラグ
  - 条件分岐ルール(Phase 2)
- プレビュー機能
- QRコード生成(Phase 2)

**入力検証:**
- リスト名: 必須、1〜200文字
- 項目数: 最低1項目以上

#### 3.3.3 チェックリスト詳細画面

**機能概要:**  
特定の作業チェックリストの詳細情報と含まれるチェック項目を表示・編集する。

**詳細要件:**
- チェックリストの基本情報表示
- 含まれるチェック項目の一覧表示
  - 項目名
  - 項目タイプ
  - 必須フラグ
  - 表示順序
- チェック項目の追加
- チェック項目の並び替え(ドラッグ&ドロップ)
- チェック項目の削除
- プレビュー機能
- 編集履歴の表示(Phase 2)

#### 3.3.4 作業チェックリスト削除

**機能概要:**  
作業チェックリストを削除または無効化する。

**詳細要件:**
- 削除前の確認ダイアログ
- 使用中のリストは削除不可(警告表示)
- 無効化オプション
- 削除履歴の記録

---

### 3.4 工程チェックシート管理

#### 3.4.1 工程チェックシート一覧表示(カンバン)

**機能概要:**  
登録済みの工程チェックシートをカンバンボード形式で一覧表示する。

**詳細要件:**
- カンバンボードによる表示
  - レーン: ステータス別(計画中/実行準備/実行中/完了)
  - カード: 工程チェックシート
- カードの表示情報
  - シート名
  - 製品名/ロット番号
  - 進捗率(%)
  - 担当者アバター
  - 期限
  - 優先度
  - タグ
- ドラッグ&ドロップによるステータス変更
- 検索機能(シート名、製品名、ロット番号)
- フィルタ機能
  - ステータス
  - 担当者
  - 期限
  - 優先度
- リスト表示への切り替え
- 新規作成ボタン
- テンプレートから作成ボタン
- レポート出力ボタン

#### 3.4.2 工程チェックシート作成・編集

**機能概要:**  
新しい工程チェックシートを作成、または既存のシートを編集する。

**詳細要件:**
- 基本情報の入力
  - シート名(必須)
  - 説明
  - 製品/ロット選択
  - 推定作業時間
  - 優先度
  - 期限
- 作業チェックリストの追加
  - 作業チェックリスト一覧から選択
  - 検索機能
  - ドラッグ&ドロップで追加
- 作業チェックリストの並び替え
  - ドラッグ&ドロップによる順序変更
- 作業チェックリストの削除
- 工程フローの定義(Phase 3)
  - ビジュアルフローエディタ
  - 直列/並列の設定
  - 条件分岐
- 担当者の割り当て
- プレビュー機能

**入力検証:**
- シート名: 必須、1〜200文字
- 作業チェックリスト: 最低1つ以上

#### 3.4.3 工程チェックシート詳細画面

**機能概要:**  
特定の工程チェックシートの詳細情報と含まれる作業チェックリストを表示・編集する。

**詳細要件:**
- 工程チェックシートの基本情報表示
- 含まれる作業チェックリストの一覧表示
  - リスト名
  - 項目数
  - 推定作業時間
  - ステータス
  - 表示順序
- 作業チェックリストの追加
- 作業チェックリストの並び替え(ドラッグ&ドロップ)
- 作業チェックリストの削除
- 実行履歴の表示
- 統計情報の表示
  - 実行回数
  - 平均実行時間
  - 合格率
  - NG項目トップ5

#### 3.4.4 工程チェックシート削除

**機能概要:**  
工程チェックシートを削除または無効化する。

**詳細要件:**
- 削除前の確認ダイアログ
- 実行履歴がある場合は削除不可(警告表示)
- 無効化オプション
- 削除履歴の記録

---

### 3.5 実行機能(作業者用)

#### 3.5.1 実行準備画面(タブレット)

**機能概要:**  
工程チェックシートの実行を開始する前に、必要な準備情報を入力する。

**詳細要件:**
- 工程チェックシートの選択
  - QRコードスキャン
  - 一覧から選択
  - 最近実行したシート
- 製品/ロット情報の確認・入力
- 実行者の確認(自動入力)
- 開始位置の記録(GPS)
- 準備チェック項目の確認
  - 必要な機材
  - 安全装備
  - 環境条件
- 実行開始ボタン

**画面レイアウト:**
- タブレット縦/横対応
- 大きなボタン(タッチ操作最適化)
- シンプルな画面構成

#### 3.5.2 チェックシート実行画面(タブレット)

**機能概要:**  
チェック項目を1つずつ表示し、結果を入力する。

**詳細要件:**
- ヘッダー部
  - 工程チェックシート名
  - 進捗バー(完了項目数/全項目数)
  - 現在のチェック項目番号
  - 経過時間
  - 一時保存ボタン
  - 終了ボタン
- チェック項目表示部
  - 項目名(大きく表示)
  - 説明文
  - 参考画像(あれば)
  - 入力フィールド(項目タイプに応じる)
- 項目タイプ別の入力UI
  - **テキスト**: テキスト入力フィールド
  - **数値**: 数値入力フィールド + 単位表示
  - **日付**: 日付ピッカー
  - **単一選択**: 大きなラジオボタン/ドロップダウン
  - **複数選択**: 大きなチェックボックス
  - **画像**: カメラ起動ボタン、画像プレビュー、再撮影ボタン
  - **署名**: 署名パッド、クリアボタン
  - **GPS**: 位置情報自動取得、地図表示
  - **ファイル**: ファイル選択ボタン
- 手書きコメント機能
  - 参考画像上に描画可能(Fabric.js使用)
  - ペン色選択(赤/青/緑/黒)
  - ペン太さ選択
  - 消しゴム
  - やり直し/戻る
  - クリア
  - 保存
- コメント入力欄
- ナビゲーションボタン
  - 前へボタン(最初の項目では無効)
  - 次へボタン(最後の項目では「完了」)
  - スキップボタン(任意項目のみ)
- フッター部
  - 項目一覧ボタン(モーダル表示)

**実行フロー:**
1. 実行準備画面から遷移
2. 最初のチェック項目を表示
3. 結果を入力
4. 「次へ」ボタンで次の項目へ
5. 全項目完了後、「完了」ボタンで実行結果確認画面へ

**オフライン対応:**
- ローカルストレージに一時保存
- オンライン復帰時に自動同期

**入力検証:**
- 必須項目の未入力チェック
- バリデーションルールのチェック
- リアルタイムエラー表示

#### 3.5.3 実行結果確認画面(タブレット)

**機能概要:**  
実行完了後、入力した結果を確認し、必要に応じて修正する。

**詳細要件:**
- サマリー情報の表示
  - 工程チェックシート名
  - 実行者
  - 実行日時
  - 実行時間
  - 総合判定(合格/不合格)
  - OK項目数
  - NG項目数
  - スキップ項目数
- チェック項目別結果の一覧表示
  - 項目名
  - 結果値
  - 判定(OK/NG/NA)
  - コメント
  - 添付ファイル(サムネイル)
- NG項目のハイライト表示
- 各項目への編集リンク(再実行)
- 終了位置の記録(GPS)
- 確定ボタン
- 下書き保存ボタン
- キャンセルボタン

**画面レイアウト:**
- タブレット縦/横対応
- スクロール可能な結果一覧
- 大きなボタン

#### 3.5.4 ドラフト保存・再開機能

**機能概要:**  
実行途中のチェックシートを保存し、後で再開できる。

**詳細要件:**
- 一時保存機能
  - 任意のタイミングで保存可能
  - ローカルストレージに保存
  - 保存日時の記録
- ドラフト一覧表示
  - 保存日時
  - 工程チェックシート名
  - 進捗率
  - 削除ボタン
- ドラフトからの再開
  - 保存した時点から再開
  - 保存データの復元

---

### 3.6 実行履歴・レビュー機能

#### 3.6.1 実行履歴一覧表示

**機能概要:**  
過去の実行履歴を一覧表示し、検索・フィルタ・ソート機能を提供する。

**詳細要件:**
- 実行履歴の一覧表示
  - 実行日時
  - 工程チェックシート名
  - 製品名/ロット番号
  - 実行者
  - 総合判定(合格/不合格)
  - ステータス(完了/承認待ち/承認済み/差し戻し)
  - NG項目数
- 検索機能(シート名、製品名、ロット番号、実行者)
- フィルタ機能
  - 実行日時範囲
  - 総合判定
  - ステータス
  - 実行者
- ソート機能(実行日時、総合判定)
- ページネーション
- 詳細表示ボタン
- PDF出力ボタン
- Excel出力ボタン

#### 3.6.2 実行結果詳細表示

**機能概要:**  
特定の実行履歴の詳細情報を表示する。

**詳細要件:**
- ヘッダー情報
  - 実行日時
  - 工程チェックシート名
  - 製品名/ロット番号
  - 実行者
  - 実行時間
  - 総合判定
  - ステータス
- チェック項目別結果の一覧表示
  - 項目名
  - 結果値
  - 判定(OK/NG/NA)
  - コメント
  - 添付ファイル(画像、署名、PDF等)
  - 記録日時
  - GPS位置情報
- NG項目のハイライト表示
- 添付ファイルの拡大表示
- 手書きコメントの表示
- 承認情報の表示(Phase 2)
  - 承認者
  - 承認日時
  - 承認コメント
- タイムライン表示
  - 実行開始
  - 各項目の記録時刻
  - 実行終了
  - 承認イベント
- 帳票出力ボタン(PDF/Excel)
- 再実行ボタン(テンプレートとして使用)

#### 3.6.3 承認ワークフロー(Phase 2)

**機能概要:**  
実行結果に対する承認プロセスを管理する。

**詳細要件:**
- 承認依頼の送信
  - 承認者の選択
  - 承認依頼メッセージ
- 承認待ちリストの表示
  - 実行日時
  - 工程チェックシート名
  - 実行者
  - 依頼日時
- 承認/差し戻しの実行
  - 承認ボタン
  - 差し戻しボタン
  - コメント入力
- 承認履歴の表示
- 通知機能
  - 承認依頼の通知(メール/システム通知)
  - 承認/差し戻しの通知

---

### 3.7 品質管理・分析機能

#### 3.7.1 ダッシュボード

**機能概要:**  
システム全体の品質状況を一目で確認できるダッシュボードを提供する。

**詳細要件:**
- KPI カード表示
  - 今月の検査実施数(前月比)
  - 合格率(前月比、目標との比較)
  - 実行中の工程数(前日比、本日予定)
  - 要対応項目数(期限超過、3件)
- クイックアクション
  - 新規検査開始
  - チェックリスト作成
  - レポート生成
  - チーム管理
- 週次検査実績グラフ
  - 過去7週間の検査数(棒グラフ)
  - 週次/月次/年次の切り替え
- 品質状況(円グラフ)
  - 合格/要注意/不合格の割合
- 通知・アラート
  - 期限超過の工程チェックシート
  - 承認待ちの実行結果
- 最近の活動
  - 実行履歴
  - 承認履歴
  - 編集履歴

#### 3.7.2 統計分析機能

**機能概要:**  
実行履歴データを集計・分析し、品質傾向を可視化する。

**詳細要件:**
- 期間別集計
  - 日次/週次/月次/年次
  - カスタム期間
- 工程別集計
  - 工程チェックシート別
  - 作業チェックリスト別
  - チェック項目別
- 製品/ロット別集計
- 作業者別集計
- 判定結果の集計
  - 合格率の推移(折れ線グラフ)
  - NG項目ランキング(棒グラフ)
  - NG原因の分類(円グラフ)
- 実行時間の分析
  - 平均実行時間の推移
  - 工程別実行時間の比較
  - 実行時間の分布(ヒストグラム)
- ヒートマップ表示
  - 曜日×時間帯別の実行数
  - NG発生頻度のヒートマップ
- フィルタ機能
  - 期間
  - 工程チェックシート
  - 製品/ロット
  - 作業者
  - 判定結果
- グラフの表示形式切り替え
  - 棒グラフ/折れ線グラフ/円グラフ/ヒートマップ
- データのエクスポート(CSV/Excel)

#### 3.7.3 トレーサビリティ機能

**機能概要:**  
製品/ロット単位で実行履歴を追跡し、品質記録を確認する。

**詳細要件:**
- 製品/ロット検索
  - 製品コード
  - ロット番号
  - 製造日範囲
- 実行履歴のタイムライン表示
  - 実行日時
  - 工程チェックシート名
  - 実行者
  - 総合判定
- 工程フローの可視化
- NG項目の詳細確認
- 添付ファイルの一括表示
- トレーサビリティレポートの出力(PDF)

#### 3.7.4 予測分析機能(Phase 3)

**機能概要:**  
過去のデータから品質異常を予測する。

**詳細要件:**
- NG発生の予測
  - 機械学習モデルによる予測
  - リスクスコアの算出
- 異常検知
  - 統計的手法による異常検知
  - アラート通知
- 推奨アクションの提示

---

### 3.8 帳票出力機能

#### 3.8.1 PDF帳票出力

**機能概要:**  
実行結果をPDF形式で出力する。

**詳細要件:**
- 出力内容
  - ヘッダー情報(工程チェックシート名、実行日時、実行者等)
  - チェック項目別結果(項目名、結果値、判定、コメント)
  - 添付ファイル(画像、署名等)
  - 手書きコメント
  - 総合判定
  - 承認情報(承認者、承認日時、承認コメント)
- レイアウト
  - A4サイズ
  - ヘッダー/フッター(ページ番号、出力日時)
  - 会社ロゴ
  - 電子署名(Phase 3)
- 出力オプション
  - NG項目のみ出力
  - 添付ファイルの含有/除外
  - カラー/モノクロ
- プレビュー機能
- ダウンロード
- 印刷
- メール送信(Phase 2)

#### 3.8.2 Excel帳票出力

**機能概要:**  
実行結果をExcel形式で出力する。

**詳細要件:**
- 出力内容
  - ヘッダー情報
  - チェック項目別結果(表形式)
  - 集計シート(合格率、NG項目数等)
  - グラフ(判定結果の円グラフ等)
- 出力オプション
  - 単一実行結果
  - 複数実行結果の一括出力(比較用)
  - 期間別集計
- ダウンロード

#### 3.8.3 CSV出力

**機能概要:**  
実行結果をCSV形式で出力する。

**詳細要件:**
- 出力内容
  - 実行履歴の一覧(フィルタ適用後)
  - チェック項目別結果の一覧
- 文字コード選択(UTF-8/Shift-JIS)
- 区切り文字選択(カンマ/タブ)
- ダウンロード

#### 3.8.4 カスタム帳票エディタ(Phase 3)

**機能概要:**  
帳票のレイアウトをカスタマイズする。

**詳細要件:**
- ドラッグ&ドロップによるレイアウト編集
- 出力項目の選択
- フォント、色、サイズの設定
- 会社ロゴの配置
- テンプレートの保存・呼び出し

---

### 3.9 システム管理

#### 3.9.1 データ保持ポリシー設定

**機能概要:**  
実行履歴データの保持期間を設定する。

**詳細要件:**
- 保持期間の設定
  - 実行履歴
  - 添付ファイル
  - ドラフトデータ
- 自動削除の設定
- データアーカイブ機能

#### 3.9.2 通知設定

**機能概要:**  
システム通知の設定を行う。

**詳細要件:**
- 通知タイプの設定
  - 承認依頼
  - 承認/差し戻し
  - 期限超過
  - NG発生
- 通知方法の設定
  - メール
  - システム内通知
  - SMS(Phase 3)
- 通知頻度の設定
  - リアルタイム
  - 日次サマリー
  - 週次サマリー

#### 3.9.3 外部システム連携API(Phase 3)

**機能概要:**  
外部システム(ERP、MES等)とのAPI連携を提供する。

**詳細要件:**
- RESTful API
  - 認証(APIキー、OAuth)
  - エンドポイント
    - 製品/ロット情報の取得
    - 実行履歴の登録
    - 実行結果の取得
  - レート制限
  - エラーハンドリング
- Webhook
  - 実行完了通知
  - NG発生通知
- データフォーマット
  - JSON
  - XML

---

### 3.10 モバイル最適化

#### 3.10.1 オフライン対応

**機能概要:**  
ネットワーク接続がない環境でもチェックシートを実行できる。

**詳細要件:**
- ローカルストレージへのデータ保存
  - 工程チェックシート
  - 作業チェックリスト
  - チェック項目マスタ
  - 実行中データ
- オンライン復帰時の自動同期
- 同期ステータスの表示
- 同期エラーの処理

#### 3.10.2 タッチUI最適化

**機能概要:**  
タブレットのタッチ操作に最適化されたUIを提供する。

**詳細要件:**
- 大きなボタン(最小44×44px)
- スワイプジェスチャー
  - 左右スワイプで項目移動
  - 下スワイプで更新
- タップ領域の最適化
- タッチフィードバック(視覚的/触覚的)

#### 3.10.3 ダークモード・高コントラストモード(Phase 2)

**機能概要:**  
視認性を向上させるための表示モードを提供する。

**詳細要件:**
- ダークモード
  - 暗い背景色
  - 目に優しい色設定
- 高コントラストモード
  - 白黒反転
  - 高コントラスト配色
- 表示モードの切り替え
- ユーザー設定の保存

---

## 4. 画面別機能詳細

### 4.1 ダッシュボード画面

**画面ID:** DASH-001  
**画面名:** ダッシュボード画面  
**アクセス権限:** 全ユーザー  
**URL:** `/dashboard`

**画面構成:**

```
+------------------------------------------------------------------+
| ヘッダー: ロゴ | ナビゲーション | ユーザー情報                   |
+------------------------------------------------------------------+
| サイドバー |  おはようございます、[ユーザー名]さん                  |
| - ダッシュボ|  2024年3月15日(金) 9:30                                |
| - マスタ管理|                                                        |
| - 工程管理  |  [アラート] 3件の工程で期限が迫っています                |
| - 実行      |  [確認する]ボタン                                       |
| - 分析・レポ|                                                        |
| - システム  |  +------------------+  +------------------+              |
|            |  | 📊 156 (+17件)  |  | ✅ 94.8% (↑3%) |              |
|            |  | 今月の検査実施数 |  | 合格率          |              |
|            |  +------------------+  +------------------+              |
|            |  +------------------+  +------------------+              |
|            |  | 😐 15 (↓5%)     |  | ⚠ 8 (↓2件)     |              |
|            |  | 実行中の工程    |  | 要対応項目      |              |
|            |  +------------------+  +------------------+              |
|            |                                                        |
|            |  クイックアクション                                    |
|            |  +---------------+  +---------------+                  |
|            |  | + 新規検査開始 |  | 📋 チェックリ |                  |
|            |  +---------------+  | スト作成      |                  |
|            |                     +---------------+                  |
|            |  +---------------+  +---------------+                  |
|            |  | 📊 レポート生成|  | 👥 チーム管理  |                  |
|            |  +---------------+  +---------------+                  |
|            |                                                        |
|            |  週次検査実績                [週次|月次|年次]           |
|            |  [棒グラフ: 過去7週間の検査数]                          |
|            |                                                        |
|            |  品質状況                                               |
|            |  [円グラフ: 合格148件(94.8%) / 要注意6件(3.8%)          |
|            |           / 不合格2件(1.3%)]                            |
+------------------------------------------------------------------+
```

**主要機能:**
- KPI カード表示
- クイックアクション
- グラフ表示(週次検査実績、品質状況)
- アラート表示

**操作フロー:**
1. ユーザーがログイン
2. ダッシュボード画面を表示
3. KPI、グラフ、アラートを確認
4. クイックアクションから各機能へ遷移

---

### 4.2 チェック項目マスタ一覧画面

**画面ID:** MASTER-001  
**画面名:** チェック項目マスタ一覧  
**アクセス権限:** 管理者、編集権限のあるユーザー  
**URL:** `/master/check-items`

**画面構成:**

```
+------------------------------------------------------------------+
| ヘッダー: ロゴ | ナビゲーション | ユーザー情報                   |
+------------------------------------------------------------------+
| サイドバー |  チェック項目マスタ一覧                              |
|            |                                                        |
|            |  [検索] [フィルタ] [+ 新規作成]                        |
|            |                                                        |
|            |  +------------------------------------------------+    |
|            |  | 項目ID | 項目名 | タイプ | カテゴリ | 使用回数 |    |
|            |  +------------------------------------------------+    |
|            |  | CHK001 | 塗装厚 | 数値   | 塗装     | 234     |    |
|            |  | CHK002 | 外観   | 選択   | 外観     | 156     |    |
|            |  | CHK003 | 寸法A  | 数値   | 寸法     | 189     |    |
|            |  | ...    | ...    | ...    | ...      | ...     |    |
|            |  +------------------------------------------------+    |
|            |                                                        |
|            |  [ページネーション: 1 2 3 ... 10]                      |
+------------------------------------------------------------------+
```

**主要機能:**
- チェック項目の一覧表示
- 検索・フィルタ・ソート
- 新規作成
- 編集・削除

**操作フロー:**
1. サイドバーから「マスタ管理」→「チェック項目マスタ」を選択
2. チェック項目マスタ一覧画面を表示
3. 検索・フィルタで項目を絞り込み
4. 「新規作成」ボタンでチェック項目編集画面へ遷移
5. 各行の「編集」ボタンでチェック項目編集画面へ遷移

---

### 4.3 チェック項目編集画面

**画面ID:** MASTER-002  
**画面名:** チェック項目編集  
**アクセス権限:** 管理者、編集権限のあるユーザー  
**URL:** `/master/check-items/:id/edit`

**画面構成:**

```
+------------------------------------------------------------------+
| ヘッダー: ロゴ | ナビゲーション | ユーザー情報                   |
+------------------------------------------------------------------+
| サイドバー |  チェック項目編集                                    |
|            |                                                        |
|            |  基本情報                                              |
|            |  項目名*: [                                  ]         |
|            |  説明:    [                                  ]         |
|            |  項目タイプ*: [数値 ▼]                                  |
|            |  カテゴリ: [塗装 ▼]                                     |
|            |  タグ:    [                                  ]         |
|            |                                                        |
|            |  項目タイプ別設定(数値の場合)                          |
|            |  最小値: [0     ]  最大値: [100   ]                    |
|            |  単位:   [μm    ]  小数点桁数: [2 ▼]                   |
|            |  デフォルト値: [        ]                              |
|            |                                                        |
|            |  バリデーションルール                                  |
|            |  ☑ 必須                                                |
|            |  エラーメッセージ: [                          ]        |
|            |                                                        |
|            |  参考画像                                              |
|            |  [参考画像をアップロード]  [プレビュー]                |
|            |  ☑ 手書きコメントを許可                                |
|            |                                                        |
|            |  [プレビュー] [保存] [キャンセル]                      |
+------------------------------------------------------------------+
```

**主要機能:**
- チェック項目の基本情報入力
- 項目タイプ別の設定
- バリデーションルール設定
- 参考画像アップロード
- プレビュー

**操作フロー:**
1. チェック項目マスタ一覧画面から「新規作成」または「編集」を選択
2. チェック項目編集画面を表示
3. 基本情報を入力
4. 項目タイプを選択
5. 項目タイプ別の設定を入力
6. バリデーションルールを設定
7. 参考画像をアップロード(任意)
8. 「保存」ボタンでデータを保存
9. チェック項目マスタ一覧画面へ戻る

---

### 4.4 作業チェックリスト一覧画面

**画面ID:** CHECKLIST-001  
**画面名:** 作業チェックリスト一覧  
**アクセス権限:** 管理者、編集権限のあるユーザー  
**URL:** `/checklists`

**画面構成:**

```
+------------------------------------------------------------------+
| ヘッダー: ロゴ | ナビゲーション | ユーザー情報                   |
+------------------------------------------------------------------+
| サイドバー |  作業チェックリスト一覧                              |
|            |                                                        |
|            |  [検索] [フィルタ] [+ 新規作成] [📋 テンプレートから] |
|            |                                                        |
|            |  +------------------------------------------------+    |
|            |  | リスト名         | 項目数 | 使用回数 | 作成日 |    |
|            |  +------------------------------------------------+    |
|            |  | 塗装前チェック   | 12     | 45      | 2024/03|    |
|            |  | 最終検査         | 24     | 38      | 2024/02|    |
|            |  | サンプル検査     | 8      | 12      | 2024/03|    |
|            |  | ...              | ...    | ...     | ...    |    |
|            |  +------------------------------------------------+    |
|            |                                                        |
|            |  [ページネーション: 1 2 3 ... 5]                       |
+------------------------------------------------------------------+
```

**主要機能:**
- 作業チェックリストの一覧表示
- 検索・フィルタ・ソート
- 新規作成
- テンプレートからコピー
- 編集・削除

**操作フロー:**
1. サイドバーから「マスタ管理」→「作業チェックリスト」を選択
2. 作業チェックリスト一覧画面を表示
3. 検索・フィルタでリストを絞り込み
4. 「新規作成」ボタンでチェックリスト詳細画面へ遷移
5. 各行の「編集」ボタンでチェックリスト詳細画面へ遷移

---

### 4.5 チェックリスト詳細画面

**画面ID:** CHECKLIST-002  
**画面名:** チェックリスト詳細  
**アクセス権限:** 管理者、編集権限のあるユーザー  
**URL:** `/checklists/:id`

**画面構成:**

```
+------------------------------------------------------------------+
| ヘッダー: ロゴ | ナビゲーション | ユーザー情報                   |
+------------------------------------------------------------------+
| サイドバー |  チェックリスト詳細                                  |
|            |                                                        |
|            |  リスト名: [塗装前チェック                  ]          |
|            |  説明:     [塗装前の準備確認項目        ]          |
|            |  カテゴリ: [塗装 ▼]                                     |
|            |  推定作業時間: [15] 分                                 |
|            |                                                        |
|            |  チェック項目 (12項目)                                 |
|            |  +------------------------------------------------+    |
|            |  | # | 項目名       | タイプ | 必須 | アクション |    |
|            |  +------------------------------------------------+    |
|            |  | 1 | 表面清掃     | 選択   | ○   | [編集][削除]|    |
|            |  | 2 | 温度確認     | 数値   | ○   | [編集][削除]|    |
|            |  | 3 | 湿度確認     | 数値   | ○   | [編集][削除]|    |
|            |  | ...                                              |    |
|            |  +------------------------------------------------+    |
|            |                                                        |
|            |  [+ チェック項目を追加]                                |
|            |                                                        |
|            |  [プレビュー] [保存] [キャンセル]                      |
+------------------------------------------------------------------+
```

**主要機能:**
- チェックリストの基本情報編集
- チェック項目の一覧表示
- チェック項目の追加
- チェック項目の並び替え(ドラッグ&ドロップ)
- チェック項目の削除
- プレビュー

**操作フロー:**
1. 作業チェックリスト一覧画面から「編集」を選択
2. チェックリスト詳細画面を表示
3. 基本情報を編集
4. 「チェック項目を追加」ボタンでチェック項目選択モーダルを表示
5. チェック項目を選択して追加
6. ドラッグ&ドロップで並び替え
7. 「保存」ボタンでデータを保存
8. 作業チェックリスト一覧画面へ戻る

---

### 4.6 工程チェックシート一覧画面(カンバン)

**画面ID:** PROCESS-001  
**画面名:** 工程チェックシート一覧(カンバン)  
**アクセス権限:** 全ユーザー  
**URL:** `/process-sheets`

**画面構成:**

```
+------------------------------------------------------------------+
| ヘッダー: ロゴ | ナビゲーション | ユーザー情報                   |
+------------------------------------------------------------------+
| サイドバー |  工程チェックシート管理                              |
|            |                                                        |
|            |  [検索] [フィルタ] [+ 新規工程シート作成]              |
|            |  [📋 テンプレートから作成] [📊 レポート出力]           |
|            |                                                        |
|            |  [すべての製品] [すべての優先度] [🗓 カンバン] [📋 リスト]|
|            |                                                        |
|            |  +----------+  +----------+  +----------+  +--------+ |
|            |  | 計画中(42)|  | 実行準備(8)|  | 実行中(12)|  | 完了(15)|
|            |  +----------+  +----------+  +----------+  +--------+ |
|            |  | [カード]  |  | [カード]  |  | [カード]  |  |[カード]|
|            |  | 製品A     |  | 製品B     |  | 製品C     |  |製品D   |
|            |  | 初期ロッ |  | 最終検査  |  | 品質検査  |  |最終検査|
|            |  | ト検査   |  | ロット:B2 |  | ロット:C1 |  |ロット:D3|
|            |  | [進捗バ] |  | [進捗バ]  |  | [進捗バ]  |  |[進捗バ]|
|            |  | 0%       |  | 0%        |  | 65%       |  |100%    |
|            |  | [アバタ] |  | [アバタ]  |  | [アバタ]  |  |[アバタ]|
|            |  | 期限:今日|  | 期限:明日 |  | 期限:本日|  |期限:昨日|
|            |  | [タグ]   |  | [タグ]    |  | [タグ]    |  |[タグ]  |
|            |  +----------+  +----------+  +----------+  +--------+ |
|            |  | + 新規追加|  | + 新規追加|  | + 新規追加|  |        |
|            |  +----------+  +----------+  +----------+  +--------+ |
+------------------------------------------------------------------+
```

**主要機能:**
- カンバンボード表示
- カードのドラッグ&ドロップによるステータス変更
- 検索・フィルタ
- 新規作成
- テンプレートから作成
- レポート出力

**操作フロー:**
1. サイドバーから「工程管理」→「工程チェックシート」を選択
2. 工程チェックシート一覧画面(カンバン)を表示
3. 検索・フィルタでシートを絞り込み
4. カードをドラッグ&ドロップでステータスを変更
5. 「新規工程シート作成」ボタンで工程チェックシート詳細画面へ遷移
6. 各カードをクリックで工程チェックシート詳細画面へ遷移

---

### 4.7 工程チェックシート詳細画面

**画面ID:** PROCESS-002  
**画面名:** 工程チェックシート詳細  
**アクセス権限:** 管理者、編集権限のあるユーザー  
**URL:** `/process-sheets/:id`

**画面構成:**

```
+------------------------------------------------------------------+
| ヘッダー: ロゴ | ナビゲーション | ユーザー情報                   |
+------------------------------------------------------------------+
| サイドバー |  工程チェックシート詳細                              |
|            |                                                        |
|            |  シート名: [製品A 初期ロット検査              ]        |
|            |  説明:     [製品Aの初期ロット品質検査      ]        |
|            |  製品:     [製品A ▼]                                    |
|            |  ロット番号: [LOT-A-001]                               |
|            |  担当者:   [田中太郎 ▼]                                 |
|            |  期限:     [2024/03/20]                                |
|            |  優先度:   [高 ▼]                                       |
|            |                                                        |
|            |  作業チェックリスト (3つ)                              |
|            |  +------------------------------------------------+    |
|            |  | # | リスト名       | 項目数 | 推定時間 | ステータス||
|            |  +------------------------------------------------+    |
|            |  | 1 | 外観検査       | 8      | 10分    | 未実行   ||
|            |  | 2 | 寸法検査       | 12     | 15分    | 未実行   ||
|            |  | 3 | 機能検査       | 6      | 20分    | 未実行   ||
|            |  +------------------------------------------------+    |
|            |                                                        |
|            |  [+ 作業チェックリストを追加]                          |
|            |                                                        |
|            |  実行履歴 (0件)                                        |
|            |  実行履歴がありません                                  |
|            |                                                        |
|            |  [保存] [実行開始] [キャンセル]                        |
+------------------------------------------------------------------+
```

**主要機能:**
- 工程チェックシートの基本情報編集
- 作業チェックリストの一覧表示
- 作業チェックリストの追加
- 作業チェックリストの並び替え(ドラッグ&ドロップ)
- 作業チェックリストの削除
- 実行履歴の表示
- 実行開始

**操作フロー:**
1. 工程チェックシート一覧画面からカードをクリック
2. 工程チェックシート詳細画面を表示
3. 基本情報を編集
4. 「作業チェックリストを追加」ボタンで作業チェックリスト選択モーダルを表示
5. 作業チェックリストを選択して追加
6. ドラッグ&ドロップで並び替え
7. 「保存」ボタンでデータを保存
8. 「実行開始」ボタンで実行準備画面へ遷移

---

### 4.8 実行準備画面(タブレット)

**画面ID:** EXEC-001  
**画面名:** 実行準備画面  
**アクセス権限:** 作業者  
**URL:** `/execution/prepare/:id`

**画面構成:**

```
+------------------------------------------------------------------+
| ヘッダー: [←戻る] 実行準備                        [田中太郎 ▼] |
+------------------------------------------------------------------+
|                                                                  |
|  製品A 初期ロット検査                                            |
|                                                                  |
|  製品情報                                                        |
|  製品: 製品A                                                     |
|  ロット番号: LOT-A-001                                           |
|  製造日: 2024/03/10                                              |
|                                                                  |
|  作業情報                                                        |
|  作業チェックリスト: 3つ                                         |
|  推定作業時間: 45分                                              |
|                                                                  |
|  実行者情報                                                      |
|  実行者: 田中太郎                                                |
|  開始時刻: 2024/03/15 10:30                                      |
|  開始位置: [GPS取得中...]                                        |
|                                                                  |
|  準備チェック                                                    |
|  ☑ 必要な機材を準備した                                         |
|  ☑ 安全装備を着用した                                           |
|  ☑ 作業環境を確認した                                           |
|                                                                  |
|                                                                  |
|  [実行開始]                                                      |
|                                                                  |
+------------------------------------------------------------------+
```

**主要機能:**
- 工程チェックシート情報の表示
- 製品/ロット情報の確認
- 実行者情報の確認
- 開始位置の記録(GPS)
- 準備チェック項目の確認

**操作フロー:**
1. 工程チェックシート詳細画面から「実行開始」を選択
2. 実行準備画面を表示
3. 製品/ロット情報を確認
4. 準備チェック項目をチェック
5. 「実行開始」ボタンでチェックシート実行画面へ遷移

---

### 4.9 チェックシート実行画面(タブレット)

**画面ID:** EXEC-002  
**画面名:** チェックシート実行画面  
**アクセス権限:** 作業者  
**URL:** `/execution/execute/:id`

**画面構成:**

```
+------------------------------------------------------------------+
| ヘッダー: [←一時保存] 製品A 初期ロット検査      [田中太郎 ▼]   |
| 進捗: [■■■■■□□□□□] 5/12  経過時間: 12分35秒            |
+------------------------------------------------------------------+
|                                                                  |
|  1. 塗装                                                         |
|                                                                  |
|  [参考画像]                                                      |
|  +----------------------------------------------------------+   |
|  |                                                          |   |
|  |              [画像表示エリア]                            |   |
|  |                                                          |   |
|  +----------------------------------------------------------+   |
|  [✏ 手書きコメント] [ペン色] [太さ] [消しゴム] [クリア]        |
|                                                                  |
|  塗装厚を測定してください                                        |
|  [              ] μm                                             |
|                                                                  |
|  コメント(任意)                                                  |
|  [                                                        ]      |
|                                                                  |
|  [📷 写真を撮影] [画像プレビュー]                                |
|                                                                  |
|                                                                  |
|  [◀ 前へ]                                        [次へ ▶]      |
|                                                                  |
+------------------------------------------------------------------+
```

**主要機能:**
- チェック項目の表示
- 項目タイプ別の入力UI
- 手書きコメント機能
- 写真撮影機能
- ナビゲーション(前へ/次へ)
- 一時保存

**操作フロー:**
1. 実行準備画面から「実行開始」を選択
2. チェックシート実行画面を表示
3. チェック項目を1つずつ確認
4. 結果を入力
5. 必要に応じて手書きコメントや写真を追加
6. 「次へ」ボタンで次の項目へ移動
7. 全項目完了後、実行結果確認画面へ遷移

---

### 4.10 実行結果確認画面(タブレット)

**画面ID:** EXEC-003  
**画面名:** 実行結果確認画面  
**アクセス権限:** 作業者  
**URL:** `/execution/review/:id`

**画面構成:**

```
+------------------------------------------------------------------+
| ヘッダー: [←戻る] 実行結果確認                    [田中太郎 ▼] |
+------------------------------------------------------------------+
|                                                                  |
|  製品A 初期ロット検査                                            |
|                                                                  |
|  サマリー                                                        |
|  実行者: 田中太郎                                                |
|  実行日時: 2024/03/15 10:30 - 11:15                              |
|  実行時間: 45分                                                  |
|  総合判定: ✅ 合格                                               |
|  OK項目: 11件 / NG項目: 1件 / スキップ: 0件                      |
|                                                                  |
|  チェック項目別結果                                              |
|  +----------------------------------------------------------+   |
|  | 1. 表面清掃          | ✅ OK    | 完了                  |   |
|  | 2. 温度確認          | ✅ OK    | 23.5℃                |   |
|  | 3. 湿度確認          | ✅ OK    | 55%                  |   |
|  | 4. 塗装厚            | ❌ NG    | 85μm (要再塗装)      |   |
|  | 5. 外観              | ✅ OK    | 良好                  |   |
|  | ...                                                      |   |
|  +----------------------------------------------------------+   |
|                                                                  |
|  [下書き保存] [確定]                                             |
|                                                                  |
+------------------------------------------------------------------+
```

**主要機能:**
- サマリー情報の表示
- チェック項目別結果の一覧表示
- NG項目のハイライト表示
- 各項目への編集リンク
- 確定
- 下書き保存

**操作フロー:**
1. チェックシート実行画面で全項目完了後、実行結果確認画面へ遷移
2. サマリー情報を確認
3. チェック項目別結果を確認
4. 必要に応じて項目を編集
5. 「確定」ボタンで実行結果を保存
6. 実行履歴一覧画面へ遷移

---

### 4.11 実行履歴一覧画面

**画面ID:** HISTORY-001  
**画面名:** 実行履歴一覧  
**アクセス権限:** 全ユーザー  
**URL:** `/execution/history`

**画面構成:**

```
+------------------------------------------------------------------+
| ヘッダー: ロゴ | ナビゲーション | ユーザー情報                   |
+------------------------------------------------------------------+
| サイドバー |  実行履歴一覧                                        |
|            |                                                        |
|            |  [検索] [フィルタ] [📄 PDF出力] [📊 Excel出力]        |
|            |                                                        |
|            |  +------------------------------------------------+    |
|            |  | 実行日時 | シート名 | 製品 | 実行者 | 判定 | ステータス||
|            |  +------------------------------------------------+    |
|            |  | 2024/03/15| 製品A   | 製品A| 田中  | 合格 | 完了    ||
|            |  | 10:30     | 初期ロッ|      |       |      |         ||
|            |  |           | ト検査  |      |       |      |         ||
|            |  +------------------------------------------------+    |
|            |  | 2024/03/14| 製品B   | 製品B| 佐藤  | 不合格| 承認待ち||
|            |  | 14:00     | 最終検査|      |       |      |         ||
|            |  +------------------------------------------------+    |
|            |  | ...                                              |    |
|            |  +------------------------------------------------+    |
|            |                                                        |
|            |  [ページネーション: 1 2 3 ... 10]                      |
+------------------------------------------------------------------+
```

**主要機能:**
- 実行履歴の一覧表示
- 検索・フィルタ・ソート
- PDF出力
- Excel出力
- 詳細表示

**操作フロー:**
1. サイドバーから「実行」→「実行履歴」を選択
2. 実行履歴一覧画面を表示
3. 検索・フィルタで履歴を絞り込み
4. 各行をクリックで実行結果詳細画面へ遷移
5. 「PDF出力」または「Excel出力」ボタンで帳票を出力

---

### 4.12 実行結果詳細表示画面

**画面ID:** HISTORY-002  
**画面名:** 実行結果詳細  
**アクセス権限:** 全ユーザー  
**URL:** `/execution/history/:id`

**画面構成:**

```
+------------------------------------------------------------------+
| ヘッダー: ロゴ | ナビゲーション | ユーザー情報                   |
+------------------------------------------------------------------+
| サイドバー |  実行結果詳細                                        |
|            |                                                        |
|            |  [📄 PDF出力] [📊 Excel出力] [🔄 再実行]              |
|            |                                                        |
|            |  ヘッダー情報                                          |
|            |  実行日時: 2024/03/15 10:30 - 11:15                    |
|            |  工程チェックシート: 製品A 初期ロット検査              |
|            |  製品: 製品A / ロット: LOT-A-001                       |
|            |  実行者: 田中太郎                                      |
|            |  実行時間: 45分                                        |
|            |  総合判定: ✅ 合格                                     |
|            |  ステータス: 完了                                      |
|            |                                                        |
|            |  チェック項目別結果                                    |
|            |  +------------------------------------------------+    |
|            |  | 項目名 | 結果値 | 判定 | コメント | 添付ファイル |    |
|            |  +------------------------------------------------+    |
|            |  | 表面清掃| 完了   | ✅ OK|          |             |    |
|            |  | 温度確認| 23.5℃ | ✅ OK|          |             |    |
|            |  | 湿度確認| 55%    | ✅ OK|          |             |    |
|            |  | 塗装厚  | 85μm   | ❌ NG| 要再塗装 | [画像]      |    |
|            |  | 外観    | 良好   | ✅ OK|          |             |    |
|            |  | ...                                              |    |
|            |  +------------------------------------------------+    |
|            |                                                        |
|            |  タイムライン                                          |
|            |  10:30 - 実行開始                                      |
|            |  10:35 - 表面清掃 完了                                 |
|            |  10:40 - 温度確認 完了                                 |
|            |  ...                                                   |
|            |  11:15 - 実行終了                                      |
+------------------------------------------------------------------+
```

**主要機能:**
- ヘッダー情報の表示
- チェック項目別結果の一覧表示
- NG項目のハイライト表示
- 添付ファイルの表示
- タイムライン表示
- PDF出力
- Excel出力
- 再実行

**操作フロー:**
1. 実行履歴一覧画面から実行履歴をクリック
2. 実行結果詳細画面を表示
3. ヘッダー情報、チェック項目別結果、タイムラインを確認
4. 添付ファイルをクリックして拡大表示
5. 「PDF出力」または「Excel出力」ボタンで帳票を出力
6. 「再実行」ボタンで同じ工程チェックシートを再実行

---

## 5. 実装優先度

### Phase 1(即実装)

**目標:** 基本的な機能を実装し、システムを稼働させる

- ユーザー管理(ログイン/ログアウト)
- チェック項目マスタ管理(CRUD)
- 作業チェックリスト管理(CRUD)
- 工程チェックシート管理(CRUD)
- 実行機能(基本)
  - 実行準備画面
  - チェックシート実行画面(テキスト、数値、単一選択、複数選択)
  - 実行結果確認画面
- 実行履歴表示
- ダッシュボード基本版(KPI表示)
- 製品/ロット紐付け
- 基本的な帳票出力(PDF)
- オフライン対応を考慮した実行画面

### Phase 2(3ヶ月以内)

**目標:** 機能を拡張し、ユーザビリティを向上させる

- 権限管理の詳細化(役割、チーム)
- チェック項目の追加タイプ(画像、署名、GPS、ファイル)
- 写真撮影機能
- 手書きコメント機能
- 承認ワークフロー
- NG項目のハイライト表示
- 基本的な統計分析(期間別集計、工程別集計)
- Excel/CSV出力
- ドラフト保存・再開機能
- 選択肢の階層管理
- 条件分岐ルール(Phase 2)
- QRコード生成
- ダークモード・高コントラストモード
- 通知機能(メール/システム内通知)

### Phase 3(6ヶ月以内)

**目標:** 高度な機能を実装し、外部システムと連携させる

- 外部システム連携API(ERP、MES等)
- 工程フローエディタ(ビジュアル編集)
- 高度な分析機能
  - ヒートマップ
  - 予測分析
  - 異常検知
- カスタム帳票エディタ
- 音声入力対応
- 二要素認証
- 電子署名(PDF)
- データアーカイブ機能

---

## 6. 非機能要件

### 6.1 パフォーマンス

- ページ読み込み時間: 3秒以内
- API応答時間: 1秒以内
- 同時接続数: 100ユーザー以上
- データベースクエリ最適化(インデックス、キャッシュ)

### 6.2 セキュリティ

- HTTPS通信
- パスワードのハッシュ化(bcrypt)
- セッション管理(JWT)
- XSS、CSRF対策
- SQLインジェクション対策
- ファイルアップロード時のウイルスチェック
- アクセスログの記録

### 6.3 可用性

- 稼働率: 99.5%以上
- バックアップ: 日次
- 障害復旧時間: 4時間以内

### 6.4 拡張性

- マイクロサービスアーキテクチャ(将来的に)
- スケーラブルなデータベース設計
- API駆動の設計

### 6.5 保守性

- コードレビュー
- 単体テスト、統合テスト
- ドキュメント整備
- ログ管理

### 6.6 ユーザビリティ

- レスポンシブデザイン(PC/タブレット対応)
- タッチ操作最適化
- アクセシビリティ対応(WCAG 2.1 AA準拠)
- 多言語対応(Phase 3)

### 6.7 互換性

- ブラウザ対応
  - Chrome(最新版)
  - Safari(最新版)
  - Edge(最新版)
  - Firefox(最新版)
- OS対応
  - Windows 10/11
  - macOS 11以降
  - iOS 14以降
  - Android 10以降

---

## 付録A: 用語集

| 用語 | 説明 |
|------|------|
| チェック項目マスタ | 検査・確認項目の基本情報を管理するマスターデータ |
| 作業チェックリスト | 複数のチェック項目をまとめた作業単位のリスト |
| 工程チェックシート | 複数の作業チェックリストを組み合わせた工程全体のシート |
| 実行履歴 | チェックシートを実行した記録 |
| 実行結果 | 各チェック項目の実行結果データ |
| 製品/ロット | 検査対象の製品またはロット情報 |
| 承認ワークフロー | 実行結果に対する承認プロセス |
| トレーサビリティ | 製品/ロット単位での品質記録の追跡 |

---

## 付録B: 変更履歴

| バージョン | 日付 | 変更内容 | 作成者 |
|-----------|------|----------|--------|
| 1.0 | 2025/03/15 | 初版作成 | Claude |

---

**以上**
